---
# AdGuard Home role defaults
# These values are loaded from the infrastructure catalog

# Load catalog values
catalog: "{{ lookup('file', playbook_dir + '/../infrastructure-catalog.yml') | from_yaml }}"

# Container configuration from catalog
adguard_container_id: 125
adguard_static_ip: "{{ catalog.services[125].ip }}"
adguard_netmask: "24"

# Service configuration
adguard_web_port: 3000
adguard_dns_port: 53

# Admin credentials
adguard_admin_username: admin
adguard_admin_password: homelab123

# DNS settings - Industry best practices for homelab
adguard_upstream_dns:
  # Privacy-focused primary DNS
  - "1.1.1.1"          # Cloudflare - Fast, privacy-focused
  - "1.0.0.1"          # Cloudflare secondary
  # Security-focused DNS with malware protection
  - "9.9.9.9"          # Quad9 - Blocks malicious domains
  - "149.112.112.112"  # Quad9 secondary
  # Reliable fallback
  - "8.8.8.8"          # Google DNS (fallback)

# DNS over HTTPS/TLS for enhanced privacy (optional but recommended)
adguard_upstream_dns_secure:
  - "https://cloudflare-dns.com/dns-query"
  - "https://dns.quad9.net/dns-query"
  - "tls://1.1.1.1"
  - "tls://9.9.9.9"

# Homelab-specific DNS settings
adguard_bootstrap_dns:
  - "1.1.1.1"
  - "8.8.8.8"

# Query logging and statistics
adguard_querylog_enabled: true
adguard_querylog_interval: "24h"
adguard_statistics_interval: "24h"

# Security and filtering settings
adguard_filtering_enabled: true
adguard_safebrowsing_enabled: true
adguard_parental_enabled: false  # Set to true if needed
adguard_safesearch_enabled: false  # Set to true for family environments

# Performance settings for homelab
adguard_blocked_response_ttl: 300
adguard_cache_size: 4194304  # 4MB cache
adguard_cache_ttl_min: 60
adguard_cache_ttl_max: 86400

# Industry-standard blocklists for homelab security
adguard_filter_lists:
  # Core AdGuard filters
  - name: "AdGuard Base Filter"
    url: "https://filters.adtidy.org/extension/edge/filters/2.txt"
    enabled: true
  - name: "AdGuard Mobile Ads Filter"
    url: "https://filters.adtidy.org/extension/edge/filters/11.txt"
    enabled: true

  # Security-focused lists
  - name: "Malware Domains"
    url: "https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts"
    enabled: true
  - name: "Dan Pollock's hosts file"
    url: "https://someonewhocares.org/hosts/zero/hosts"
    enabled: true

  # Privacy protection
  - name: "EasyPrivacy"
    url: "https://easylist.to/easylist/easyprivacy.txt"
    enabled: true
  - name: "AdGuard Tracking Protection"
    url: "https://filters.adtidy.org/extension/edge/filters/3.txt"
    enabled: true

  # Regional and supplementary (optional)
  - name: "EasyList"
    url: "https://easylist.to/easylist/easylist.txt"
    enabled: true

# Local DNS rewrites for homelab infrastructure
adguard_dns_rewrites:
  # Internal homelab domains
  - domain: "proxmox.homelab"
    ip: "{{ catalog.proxmox.ip }}"
  - domain: "pve.homelab"
    ip: "{{ catalog.proxmox.ip }}"
  - domain: "adguard.homelab"
    ip: "{{ adguard_static_ip }}"

  # Service-specific domains for easy access
  - domain: "dns.homelab"
    ip: "{{ adguard_static_ip }}"
  - domain: "coolify.homelab"
    ip: "{{ catalog.services[160].ip }}"
  - domain: "*.coolify.homelab"  # Wildcard for Coolify deployed applications
    ip: "{{ catalog.services[160].ip }}"
  - domain: "ollama.homelab"
    ip: "{{ catalog.services[140].ip }}"
  - domain: "vllm.homelab"
    ip: "{{ catalog.services[140].ip }}"

# Custom filtering rules for homelab
adguard_custom_filtering_rules:
  # Allow local network ranges
  - "@@||192.168.0.0/24^"
  - "@@||10.0.0.0/8^"
  - "@@||172.16.0.0/12^"

  # Block common tracking and telemetry
  - "||google-analytics.com^"
  - "||googletagmanager.com^"
  - "||facebook.com/tr/*"

  # Allow essential services
  - "@@||github.com^"
  - "@@||docker.io^"
  - "@@||registry-1.docker.io^"

# Client identification settings
adguard_clients_persistent: true

# Bind addresses
adguard_web_bind: "0.0.0.0"
adguard_dns_bind: "0.0.0.0"

# DHCP Server Configuration
# WARNING: Enable ONLY after disabling router DHCP to avoid network conflicts!
adguard_dhcp_enabled: true  # ENABLED: Router DHCP has been disabled
adguard_dhcp_interface: "eth0"
adguard_dhcp_local_domain: "lan"

# DHCP IPv4 Configuration
# Range: 192.168.0.200-249 (per ADR-002 network strategy)
# This range does not conflict with static IPs (.1-.199)
adguard_dhcp_gateway: "{{ catalog.network.gateway }}"  # Router IP
adguard_dhcp_subnet_mask: "255.255.255.0"
adguard_dhcp_range_start: "192.168.0.200"
adguard_dhcp_range_end: "192.168.0.249"
adguard_dhcp_lease_duration: 86400  # 24 hours in seconds
adguard_dhcp_icmp_timeout: 1000  # Milliseconds