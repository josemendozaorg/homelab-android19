---
# Coolify installation tasks
# Install Coolify platform using official installation script

- name: Check if Coolify is already installed
  ansible.builtin.stat:
    path: /usr/local/bin/coolify
  register: coolify_binary
  become: yes

- name: Download Coolify installation script
  ansible.builtin.get_url:
    url: "{{ coolify_install_script_url }}"
    dest: /tmp/coolify-install.sh
    mode: '0755'
  when: not coolify_binary.stat.exists
  become: yes

- name: Execute Coolify installation script
  ansible.builtin.shell: /tmp/coolify-install.sh
  args:
    creates: /usr/local/bin/coolify
  when: not coolify_binary.stat.exists
  become: yes

- name: Verify Coolify service is running
  ansible.builtin.systemd:
    name: coolify
    state: started
    enabled: yes
  become: yes
