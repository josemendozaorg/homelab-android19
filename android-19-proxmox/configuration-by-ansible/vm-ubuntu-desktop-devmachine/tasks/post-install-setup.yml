---
# Post-Install Setup Tasks
# Creates scripts and configurations for after Ubuntu Desktop installation

- name: Display post-install setup
  ansible.builtin.debug:
    msg: |
      🔧 Creating post-install automation scripts

      This will create:
      1. Network configuration script (static IP)
      2. SSH setup script (key authentication)
      3. Omakub installation script (first login)
      4. User setup script (git config, etc.)

- name: Create post-install scripts directory
  ansible.builtin.file:
    path: "{{ iso_storage_path }}/ubuntu-post-install"
    state: directory
    mode: '0755'

- name: Generate master setup script
  ansible.builtin.template:
    src: ubuntu-post-install.sh.j2
    dest: "{{ iso_storage_path }}/ubuntu-post-install/ubuntu-post-install.sh"
    mode: '0755'

- name: Display post-install scripts status
  ansible.builtin.debug:
    msg: |
      ✅ Post-install script created successfully

      📁 Location: {{ iso_storage_path }}/ubuntu-post-install/
      📄 Script created:
        - ubuntu-post-install.sh (complete automation script)

      🎯 Usage after Ubuntu installation:
      1. SSH to VM: ssh {{ dev_user }}@{{ ubuntu_vm.ip }}
      2. Copy and run: wget http://192.168.0.19:8080/ubuntu-post-install/ubuntu-post-install.sh && bash ubuntu-post-install.sh
      3. Or manually copy from {{ iso_storage_path }}/ubuntu-post-install/

      🚀 This will configure everything automatically:
      - Static IP configuration ({{ network_config.ip_address }})
      - SSH key authentication
      - Git configuration
      - Omakub installation on first GUI login